services:
  master:
    build: .
    image: crawlabteam/crawlab:${CRAWLAB_VERSION:-develop}
    container_name: crawlab_test_master
    environment:
      CRAWLAB_NODE_NAME: "Master Node"
      CRAWLAB_NODE_MASTER: "Y"
      CRAWLAB_MONGO_HOST: "mongo"
      CRAWLAB_MONGO_PORT: "27017"
      CRAWLAB_MONGO_DB: "crawlab"
      CRAWLAB_MONGO_USERNAME: "dev_user"
      CRAWLAB_MONGO_PASSWORD: "dev_password"
      CRAWLAB_MONGO_AUTHSOURCE: "admin"
      CRAWLAB_PPROF: "true"
      CRAWLAB_LOG_LEVEL: "debug"
    ports:
      - "8080:8080"
      - "6060:6060"
    depends_on:
      - mongo
    env_file:
      - .env

  worker-01:
    build: .
    image: crawlabteam/crawlab:${CRAWLAB_VERSION:-develop}
    container_name: crawlab_test_worker_01
    environment:
      CRAWLAB_NODE_NAME: "Worker Node 01"
      CRAWLAB_NODE_MASTER: "N"
      CRAWLAB_MASTER_HOST: "master"
    depends_on:
      - master
    env_file:
      - .env

  worker-02:
    build: .
    image: crawlabteam/crawlab:${CRAWLAB_VERSION:-develop}
    container_name: crawlab_test_worker_02
    environment:
      CRAWLAB_NODE_NAME: "Worker Node 02"
      CRAWLAB_NODE_MASTER: "N"
      CRAWLAB_MASTER_HOST: "master"
    depends_on:
      - master
    env_file:
      - .env

  mongo:
    image: mongo:5
    container_name: crawlab_test_mongo
    environment:
      MONGO_INITDB_ROOT_USERNAME: "dev_user"
      MONGO_INITDB_ROOT_PASSWORD: "dev_password"
    ports:
      - "${MONGO_PORT:-27017}:27017"
    env_file:
      - .env
